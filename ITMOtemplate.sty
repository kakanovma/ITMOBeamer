
\mode<presentation>
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Define the colors of the corporate style.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{ITMOblue}{RGB}{25,70,186} 
\definecolor{ITMOred}{RGB}{236,11,67} 
\definecolor{ITMOwhite}{RGB}{255,255,255} 
\definecolor{ITMOPeach}{RGB}{255,132,0}
\definecolor{ITMOSkyBlue}{RGB}{61,181,230}
\definecolor{ITMOHerbal}{RGB}{25,70,186}
\definecolor{ITMOMint}{RGB}{0,174,157}
\definecolor{ITMOSeaWave}{RGB}{94, 192, 213}
\definecolor{ITMOMango}{RGB}{255,230,13}
\definecolor{ITMOLemon}{RGB}{235,231,14}
\definecolor{ITMOCoral}{RGB}{234,65,38}
\definecolor{ITMOEmerald}{RGB}{0,148,77}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Polygons background
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\pgfdeclareimage[width=\paperwidth]{polygons}{figs/itmo_polygons.pdf}

\newcommand{\itmopolygons}[1]{
    \noindent\begin{picture}(0,0)
        \put(-31.5,-153.65){
        \begin{tikzpicture}
            \includegraphics[height=\paperheight,width=\paperwidth]{figs/itmo_polygons.pdf}
        \end{tikzpicture}
        }
        \put(-28.3,110){%
            \begin{minipage}[t][\paperheight][c]{\paperwidth}
                \begin{center}
                    \usebeamercolor[fg]{title}{ 
                        #1
                    }
                \end{center}
            \end{minipage}
        }
    \end{picture}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Headline
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{headline}{\vskip-.1px}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Footline
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{footline}{
   \begin{beamercolorbox}[ht=3ex,dp=2ex,leftskip=1.4cm,rightskip=.3cm]{section in head/foot}
     \insertsectionnavigationhorizontal{.8\textwidth}{}{}
     \hfill 
     \insertframenumber~/ \inserttotalframenumber 
     \hspace{2pt} 
   \end{beamercolorbox}
} 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Title page
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamercolor{title}{fg=ITMOwhite}

\setbeamertemplate{title page}
{
  \itmopolygons{
  \vbox{}
  \vfill
  \begin{centering}
      \begin{center}
        \vspace{1cm}
        \includegraphics[height = 1.5cm]{figs/itmo_logo_transp_en.png} \\
        \vspace{1cm}

        \noindent\makebox[\textwidth][c]{%
        \begin{minipage}{0.9\textwidth}
                \centering{\bf\Large\inserttitle}
        \end{minipage}}

        \vspace{1cm}

        {\scriptsize\insertauthor}

        \vspace{0.3cm}

        {\insertinstitute}

        \vspace{0.7cm}
        {\scriptsize\insertdate}
      \end{center}
  \end{centering}
  \vfill
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Frame
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{sidebar right}{}
\setbeamertemplate{navigation symbols}{}
\setbeamercolor{section in head/foot}{bg=ITMOblue, fg=ITMOwhite}

\setbeamertemplate{frametitle}{
\begin{beamercolorbox}[wd=\paperwidth,ht=18pt,left,leftskip=10px,dp=10pt]{section in head/foot}
  \begin{minipage}{0.83\textwidth}
  \insertframetitle
  \end{minipage}
  \begin{minipage}{0.17\textwidth}
  \includegraphics[height = 0.4cm]{figs/itmo_logo_horiz_transp_en.png}
  \end{minipage}
\end{beamercolorbox}
}

\logo{\includegraphics[height=1.5cm]{figs/itmo_logo_transp_en.png}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Beamer Features
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Overlays
\setbeamercovered{transparent}
%%%%% Alert
\setbeamercolor{alerted text}{fg=ITMOred,bg=white}
\newcommand{\boxalert}[1]{{%
  \colorbox{ITMOred}{\color{white}{#1}}%
}}
\usestructuretemplate{\color{ITMOblue}}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Blocks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamercolor{block title alerted}{fg=white,bg=ITMOred}

\setbeamercolor{block title}{use=structure,fg=white,bg=ITMOMint}
\setbeamercolor{block body}{use=structure,fg=black,bg=white}

\setbeamercolor{block body example}{bg=white}
\setbeamercolor{block title example}{fg=white, bg=ITMOPeach}

\makeatletter
\newcommand\beamerboxesframed[2][]{%
  \global\let\beamer@firstlineitemizeunskip=\relax%
  \vbox\bgroup%
  \setkeys{beamerboxes}{upper=block title,lower=block body,width=\textwidth}%
  \setkeys{beamerboxes}{#1}%
  {%
    \usebeamercolor{\bmb@lower}%
    \globalcolorstrue%
    \colorlet{lower.bg}{bg}%
  }%
  {%
    \usebeamercolor{\bmb@upper}%
    \globalcolorstrue%
    \colorlet{upper.bg}{bg}%
  }%
  %
  % Typeset head
  %
  \vskip4bp
  \setbox\bmb@box=\hbox{%
    \begin{minipage}[b]{\bmb@width}%
      \usebeamercolor[fg]{\bmb@upper}%
      #2%
    \end{minipage}}%
  \ifdim\wd\bmb@box=0pt%
    \setbox\bmb@box=\hbox{}%
    \ht\bmb@box=0pt%
    \bmb@prevheight=-4.5pt%
  \else%
    \wd\bmb@box=\bmb@width%
    \bmb@temp=\dp\bmb@box%
    \ifdim\bmb@temp<1.5pt%
      \bmb@temp=1.5pt%
    \fi%
    \setbox\bmb@box=\hbox{\raise\bmb@temp\hbox{\box\bmb@box}}%
    \dp\bmb@box=0pt%
    \bmb@prevheight=\ht\bmb@box%
  \fi%
  \bmb@temp=\bmb@width%
  \bmb@dima=\bmb@temp\advance\bmb@dima by0bp%
  \bmb@dimb=\bmb@temp\advance\bmb@dimb by0bp%
  \hbox{%
    \begin{pgfpicture}{0bp}{+-\ht\bmb@box}{0bp}{+-\ht\bmb@box}
      \ifdim\wd\bmb@box=0pt%
        \color{lower.bg}%
      \else%
        \color{upper.bg}%
      \fi%
      \pgfpathqmoveto{-4bp}{2.2bp}
      % \pgfpathqcurveto{-4bp}{1.2bp}{0bp}{3bp}{0bp}{3bp}
      \pgfpathlineto{\pgfpoint{\bmb@temp}{3bp}}
      \pgfpathcurveto%
      {\pgfpoint{\bmb@dima}{3bp}}%
      {\pgfpoint{\bmb@dimb}{1.2bp}}%
      {\pgfpoint{\bmb@dimb}{-1bp}}%
      \bmb@dima=-\ht\bmb@box%
      \advance\bmb@dima by-2pt%
      \pgfpathlineto{\pgfpoint{\bmb@dimb}{\bmb@dima}}
      \pgfpathlineto{\pgfpoint{-4bp}{\bmb@dima}}
      \pgfpathclose
      \pgfsetstrokecolor{black}\pgfusepath{stroke, fill}
    \end{pgfpicture}%
    \copy\bmb@box%
  }%
  \nointerlineskip%
  \ifdim\wd\bmb@box=0pt
  \else
    \vskip2.4pt%
  \fi%
  \nointerlineskip%
  \setbox\bmb@colorbox=\hbox{{\pgfpicturetrue\pgfsetcolor{lower.bg}}}%
  \setbox\bmb@box=\hbox\bgroup\begin{minipage}[b]{\bmb@width}%
    \vskip2pt%
    \usebeamercolor[fg]{\bmb@lower}%
    \colorlet{beamerstructure}{upper.bg}%
    \colorlet{structure}{upper.bg}%
    %\color{.}%
}

\def\endbeamerboxesframed{%
  \end{minipage}\egroup%
  \wd\bmb@box=\bmb@width%
  \bmb@temp=\dp\bmb@box%
  \advance\bmb@temp by.5pt%
  \setbox\bmb@box=\hbox{\raise\bmb@temp\hbox{\box\bmb@box}}%
  \dp\bmb@box=0pt%
  \bmb@temp=\wd\bmb@box%
  \bmb@dima=\bmb@temp\advance\bmb@dima by0bp%
  \bmb@dimb=\bmb@temp\advance\bmb@dimb by0bp%
  \hbox{%
    \begin{pgfpicture}{0bp}{0bp}{0bp}{0bp}
      \unhbox\bmb@colorbox%
      \pgfpathmoveto{\pgfpoint{-4bp}{\ht\bmb@box}}
      \pgfpathlineto{\pgfpoint{-4bp}{-3.2bp}}
      % \pgfpathqcurveto{-4bp}{-1.2bp}{-2.2bp}{-3bp}{0bp}{-3bp}
      \pgfpathlineto{\pgfpoint{\the\bmb@temp}{-3bp}}
      \pgfpathcurveto%
      {\pgfpoint{\the\bmb@dima}{-3bp}}%
      {\pgfpoint{\the\bmb@dimb}{-1.2bp}}%
      {\pgfpoint{\the\bmb@dimb}{1bp}}%
      {
      \bmb@dima=\ht\bmb@box%
      \pgfpathlineto{\pgfpoint{\bmb@dimb}{\bmb@dima}}
      \pgfsetstrokecolor{black}\pgfusepath{stroke, fill}
      }
    \end{pgfpicture}%
    \box\bmb@box%
  }%
  \vskip2bp%
  \egroup% of \vbox\bgroup
}
\makeatother

\defbeamertemplateparent{blocks}[framed]{block begin,block end,%
  block alerted begin,block alerted end,%
  block example begin,block example end}[1][]
{[#1]}

\defbeamertemplate{block begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title,lower=block body,#1]%
    {\raggedright\usebeamerfont*{block title}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body}%
}
\defbeamertemplate{block end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\defbeamertemplate{block alerted begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title alerted,lower=block body alerted,#1]%
    {\raggedright\usebeamerfont*{block title alerted}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body alerted}%
}%
\defbeamertemplate{block alerted end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\defbeamertemplate{block example begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title example,lower=block body example,#1]
    {\raggedright\usebeamerfont*{block title example}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body alerted}%
}%
\defbeamertemplate{block example end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\setbeamertemplate{blocks}[framed]


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Fancylist environment
%%%%% https://tex.stackexchange.com/questions/385663/custom-enumerate-list-align-enumerate-label-at-the-center-of-text
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[raster,most]{tcolorbox}
% a default color
% \definecolor{ITMOblue}{HTML}{03A9F4}
% \definecolor{BodyColor}{black}
\newcounter{fancycount}
% lets define some options using pgfkeys 
% https://tex.stackexchange.com/questions/34312/how-to-create-a-command-with-key-values
\pgfkeys{
 /fancylist/.is family, /fancylist,
 default/.style = 
  {shape = ring, color = ITMOblue},
  shape/.estore in = \myshape,
  color/.estore in = \mycolor,
}

\newenvironment{fancylist}[1][color=ITMOSeaWave, shape=circle]{%
  \pgfkeys{/fancylist, default, #1}%

  % lets decide label shape based on option
  \def\mysquare{square}
  \def\myring{ring}
  \def\myhollowsquare{hollowsquare}
  \ifx\myshape\mysquare
  \def\mydraw{
  \node[draw=\mycolor,rectangle,minimum width=7.0mm, minimum height=7.0mm, inner sep=0pt,fill=\mycolor] at (X) {\refstepcounter{fancycount}\Large\arabic{fancycount}}
  }
  \else
    \ifx\myshape\myhollowsquare
    \def\mydraw{
      \node[draw=\mycolor,rectangle,minimum width=7.0mm, minimum height=7.0mm, inner sep=0pt] at (X) {\refstepcounter{fancycount}\Large\arabic{fancycount}}
      }
    \else
      \ifx\myshape\myring
        \def\mydraw{
        \node[draw=\mycolor,circle,minimum width=7.0mm,inner sep=0pt] at (X) {\refstepcounter{fancycount}\Large\arabic{fancycount}}
        }
      \else
        \def\mydraw{
        \node[draw=\mycolor,circle,minimum width=7.0mm,inner sep=0pt,fill=\mycolor] at (X) {\refstepcounter{fancycount}\Large\arabic{fancycount}}
        }
      \fi
    \fi
  \fi

  \setcounter{fancycount}{0}
  % lets keep it simple and ask users to use \item
  \def\item{\tcbitem}
  \begin{tcbitemize}[raster columns=1,    
    nofloat,
    enhanced,
    raster left skip=10.0mm,
    sharp corners=all,
    opacityfill=0,
    valign=center,
    coltext=black,
    overlay={\coordinate (X) at ([xshift=-7.50mm]frame.west);
      \mydraw; \draw[very thick, color=\mycolor] (frame.north west) -- (frame.south west); }]}{\end{tcbitemize}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Fancybox 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newsavebox\mybox
\providecommand\fancybox[3][ITMOblue]{%
\tcbset{
  mybox/.style={
    enhanced,
    grow to left by=-2.5cm,
    boxsep=0mm,
    sharp corners=all,
    opacityfill=0,
    coltext=black,
    overlay={
      \coordinate (X) at ([xshift=-1mm, yshift=-1.5mm]frame.north west);
      \node[align=right, text=#1, text width=2.5cm, anchor=north east] at (X) {#2};
      \draw[line width=0.5mm, color=#1] (frame.north west) -- (frame.south west); 
      }
    }
  }

\begin{tcolorbox}[mybox]
  efdf: #3
\end{tcolorbox}


}


\usepackage[framemethod=TikZ]{mdframed}
\usepackage{amsthm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Theorem
\newcounter{theo} \setcounter{theo}{0}
\renewcommand{\thetheo}{\arabic{theo}}
\resetcounteronoverlays{theo}

\renewenvironment<>{theorem}[1][]{%
    \refstepcounter{theo}
    \tcbset{
      mybox/.style={
        enhanced,
        grow to left by=-2cm,
        boxsep=0mm,
        sharp corners=all,
        opacityfill=0,
        coltext=black,
        overlay={
          \coordinate (X) at ([xshift=-1mm, yshift=-1.5mm]frame.north west);
          \node[align=right, text=ITMOblue, text width=2.5cm, anchor=north east] at (X) {Theorem~\thetheo};
          \draw[line width=0.5mm, color=ITMOblue] (frame.north west) -- (frame.south west); 
          }
        }
      }
    \begin{actionenv}\begin{tcolorbox}[mybox]
      \textit{#1} \\
}{
    \end{tcolorbox}\end{actionenv}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Proof
\renewenvironment<>{proof}{%
    \tcbset{
      mybox/.style={
        enhanced,
        grow to left by=-2cm,
        boxsep=0mm,
        sharp corners=all,
        opacityfill=0,
        coltext=black,
        overlay={
          \coordinate (X) at ([xshift=-1mm, yshift=-1.5mm]frame.north west);
          \node[align=right, text=ITMOEmerald, text width=2.5cm, anchor=north east] at (X) {Proof.};
          \draw[line width=0.5mm, color=ITMOEmerald] (frame.north west) -- (frame.south west); 
          }
        }
      }
    \begin{tcolorbox}[mybox]
}{
    \hfill\qedsymbol\end{tcolorbox}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Example
\newcounter{exmpl} \setcounter{exmpl}{0}
\renewcommand{\theexmpl}{\arabic{exmpl}}
\resetcounteronoverlays{exmpl}

\renewenvironment<>{example}{%
    \refstepcounter{exmpl}
    \tcbset{
      mybox/.style={
        enhanced,
        grow to left by=-2cm,
        boxsep=0mm,
        sharp corners=all,
        opacityfill=0,
        coltext=black,
        overlay={
          \coordinate (X) at ([xshift=-1mm, yshift=-1.5mm]frame.north west);
          \node[align=right, text=ITMOPeach, text width=2.5cm, anchor=north east] at (X) {Example~\theexmpl};
          \draw[line width=0.5mm, color=ITMOPeach] (frame.north west) -- (frame.south west); 
          }
        }
      }
    \begin{tcolorbox}[mybox]
      \textit{#1} \par
}{
    \end{tcolorbox}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Alertblock
\renewenvironment<>{alertblock}[1]{%
    \tcbset{
      mybox/.style={
        enhanced,
        grow to left by=-2cm,
        boxsep=0mm,
        sharp corners=all,
        opacityfill=0,
        coltext=black,
        overlay={
          \coordinate (X) at ([xshift=-1mm, yshift=-1.5mm]frame.north west);
          \node[align=right, text=ITMOred, text width=2.5cm, anchor=north east] at (X) {#1};
          \draw[line width=0.5mm, color=ITMOred] (frame.north west) -- (frame.south west); 
          }
        }
      }
    \begin{tcolorbox}[mybox]
}{
    \end{tcolorbox}
}