
\date[Ocasion]{Date\\Ocasion}

\definecolor{ITMOblue}{RGB}{25,70,186} 
\definecolor{ITMOred}{RGB}{236,11,67} 
\definecolor{ITMOwhite}{RGB}{255,255,255} 

\setlength{\parindent}{5ex}

\logo{\includegraphics[height=1.5cm]{figs/itmo_logo_transp_en.png}}

\setbeamertemplate{headline}
    {%
      \begin{beamercolorbox}{section in head/foot}
        \vskip2pt\insertnavigation{\paperwidth}\vskip2pt
      \end{beamercolorbox}%
    }
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{footline}[page number]{}
\pgfdeclareimage[width=\paperwidth]{polygons}{figs/itmo_polygons.pdf}
\setbeamercolor{title}{fg=ITMOwhite}

\newcommand{\itmopolygons}[1]{
    \noindent\begin{picture}(0,0)
        \put(-31.5,-153.65){
        \begin{tikzpicture}
            \includegraphics[height=\paperheight,width=\paperwidth]{figs/itmo_polygons.pdf}
        \end{tikzpicture}
        }
        \put(-28.3,110){%
            \begin{minipage}[t][\paperheight][c]{\paperwidth}
                \begin{center}
                    \usebeamercolor[fg]{title}{ 
                        #1
                    }
                \end{center}
            \end{minipage}
        }
    \end{picture}
}

% Redefine title page
\setbeamertemplate{title page}
{
  \itmopolygons{
  \vbox{}
  \vfill
  \begin{centering}
      \begin{center}
        \vspace{1cm}
        \includegraphics[height = 1.5cm]{figs/itmo_logo_transp_en.png} \\
        \vspace{1cm}

        \noindent\makebox[\textwidth][c]{%
        \begin{minipage}{0.9\textwidth}
                \centering{\bf\Large\inserttitle}
        \end{minipage}}

        \vspace{1cm}

        {\scriptsize\insertauthor}

        \vspace{0.3cm}

        {\insertinstitute}

        \vspace{0.7cm}
        {\scriptsize\insertdate}
      \end{center}
  \end{centering}
  \vfill
  }
}
\setbeamercolor{palette primary}{bg=ITMOblue}
\setbeamercolor{frametitle}{bg=ITMOblue, fg=ITMOwhite}
\setbeamercolor{section in head/foot}{bg=ITMOblue, fg=ITMOwhite}
\setbeamercolor{footline}{bg=ITMOblue, fg=ITMOred}
\setbeamertemplate{headline}{
% \begin{beamercolorbox}[wd=\paperwidth,ht=5.5pt,dp=7pt]{section in head/foot}
	% \insertnavigation{\textwidth}
% \end{beamercolorbox}

\vskip-.1px
}
% \setbeamertemplate{footline}{
% 	\begin{beamercolorbox}[wd=0.5\paperwidth,ht=5.5pt,left,dp=2pt]{section in head/foot}
% 		\insertnavigation{0.5\textwidth}
% 	\end{beamercolorbox}
% 	\begin{beamercolorbox}[wd=0.3\paperwidth,right,ht=5.5pt,dp=2pt]{section in head/foot}
% 		\insertpagenumber~/ \inserttotalframenumber \hspace{2pt}
% 	\end{beamercolorbox}
% }
% \setbeamertemplate{mini frame in other subsection of current section}[default][0]
\setbeamercolor*{mini frame}{fg=ITMOred,bg=white}

\setbeamercolor*{mini frame in section}{fg=ITMOred,bg=white}
\setbeamertemplate{mini frame in other section}[default][0]
\setbeamertemplate{mini frame in other subsection}[default][0]

% \setbeamertemplate{mini frame in other section}[default][0]
% \setbeamertemplate{mini frame in other subsection}[default][0]
% \setbeamertemplate{navigation symbols}{}
% \mode<beamer>{\setbeamertemplate{blocks}[rounded][shadow=true]}
% \setbeamercolor{section in head/foot}{parent=palette tertiary,fg=red}
% \setbeamertemplate{section in head/foot shaded}    {\color{gray}\usebeamertemplate{section in head/foot}}
% \setbeamercolor{section in head/foot}{fg=white, bg=ITMOblue}

% \useoutertheme[subsection=false]{miniframes}

\setbeamertemplate{footline}{
   % \unilogo
   % \dsglogo
   \begin{beamercolorbox}[ht=3ex,dp=2ex,leftskip=1.4cm,rightskip=.3cm]{section in head/foot}
   % \insertnavigation{0.7\textwidth} 
   \insertsectionnavigationhorizontal{.8\textwidth}{}{}
   \hfill \insertframenumber~/ \inserttotalframenumber \hspace{2pt} 
   \end{beamercolorbox}
   % \vspace*{0.1cm}
} 
\setbeamertemplate{frametitle}{
\begin{beamercolorbox}[wd=\paperwidth,ht=18pt,left,leftskip=10px,dp=10pt]{section in head/foot}
	\begin{minipage}{0.83\textwidth}
	\insertframetitle
	\end{minipage}
	\begin{minipage}{0.17\textwidth}
	\includegraphics[height = 0.4cm]{figs/itmo_logo_horiz_transp_en.png}
	\end{minipage}
\end{beamercolorbox}
}

\setbeamercovered{transparent}



\setbeamercolor{block title alerted}{fg=white,bg=ITMOred}
%body
\setbeamercolor{block body alerted}{fg=black!90,bg=white}
% parent of all alerts default is red
\setbeamercolor{alerted text}{fg=green}
% \setbeamertemplate{blocks}[rounded][shadow=false]

\makeatletter
\newcommand\beamerboxesframed[2][]{%
  \global\let\beamer@firstlineitemizeunskip=\relax%
  \vbox\bgroup%
  \setkeys{beamerboxes}{upper=block title,lower=block body,width=\textwidth}%
  \setkeys{beamerboxes}{#1}%
  {%
    \usebeamercolor{\bmb@lower}%
    \globalcolorstrue%
    \colorlet{lower.bg}{bg}%
  }%
  {%
    \usebeamercolor{\bmb@upper}%
    \globalcolorstrue%
    \colorlet{upper.bg}{bg}%
  }%
  %
  % Typeset head
  %
  \vskip4bp
  \setbox\bmb@box=\hbox{%
    \begin{minipage}[b]{\bmb@width}%
      \usebeamercolor[fg]{\bmb@upper}%
      #2%
    \end{minipage}}%
  \ifdim\wd\bmb@box=0pt%
    \setbox\bmb@box=\hbox{}%
    \ht\bmb@box=0pt%
    \bmb@prevheight=-4.5pt%
  \else%
    \wd\bmb@box=\bmb@width%
    \bmb@temp=\dp\bmb@box%
    \ifdim\bmb@temp<1.5pt%
      \bmb@temp=1.5pt%
    \fi%
    \setbox\bmb@box=\hbox{\raise\bmb@temp\hbox{\box\bmb@box}}%
    \dp\bmb@box=0pt%
    \bmb@prevheight=\ht\bmb@box%
  \fi%
  \bmb@temp=\bmb@width%
  \bmb@dima=\bmb@temp\advance\bmb@dima by0bp%
  \bmb@dimb=\bmb@temp\advance\bmb@dimb by0bp%
  \hbox{%
    \begin{pgfpicture}{0bp}{+-\ht\bmb@box}{0bp}{+-\ht\bmb@box}
      \ifdim\wd\bmb@box=0pt%
        \color{lower.bg}%
      \else%
        \color{upper.bg}%
      \fi%
      \pgfpathqmoveto{-4bp}{2.2bp}
      % \pgfpathqcurveto{-4bp}{1.2bp}{0bp}{3bp}{0bp}{3bp}
      \pgfpathlineto{\pgfpoint{\bmb@temp}{3bp}}
      \pgfpathcurveto%
      {\pgfpoint{\bmb@dima}{3bp}}%
      {\pgfpoint{\bmb@dimb}{1.2bp}}%
      {\pgfpoint{\bmb@dimb}{-1bp}}%
      \bmb@dima=-\ht\bmb@box%
      \advance\bmb@dima by-2pt%
      \pgfpathlineto{\pgfpoint{\bmb@dimb}{\bmb@dima}}
      \pgfpathlineto{\pgfpoint{-4bp}{\bmb@dima}}
      \pgfpathclose
      \pgfsetstrokecolor{black}\pgfusepath{stroke, fill}
    \end{pgfpicture}%
    \copy\bmb@box%
  }%
  \nointerlineskip%
  \ifdim\wd\bmb@box=0pt
  \else
    \vskip2.4pt%
  \fi%
  \nointerlineskip%
  \setbox\bmb@colorbox=\hbox{{\pgfpicturetrue\pgfsetcolor{lower.bg}}}%
  \setbox\bmb@box=\hbox\bgroup\begin{minipage}[b]{\bmb@width}%
    \vskip2pt%
    \usebeamercolor[fg]{\bmb@lower}%
    \colorlet{beamerstructure}{upper.bg}%
    \colorlet{structure}{upper.bg}%
    %\color{.}%
}

\def\endbeamerboxesframed{%
  \end{minipage}\egroup%
  \wd\bmb@box=\bmb@width%
  \bmb@temp=\dp\bmb@box%
  \advance\bmb@temp by.5pt%
  \setbox\bmb@box=\hbox{\raise\bmb@temp\hbox{\box\bmb@box}}%
  \dp\bmb@box=0pt%
  \bmb@temp=\wd\bmb@box%
  \bmb@dima=\bmb@temp\advance\bmb@dima by0bp%
  \bmb@dimb=\bmb@temp\advance\bmb@dimb by0bp%
  \hbox{%
    \begin{pgfpicture}{0bp}{0bp}{0bp}{0bp}
      \unhbox\bmb@colorbox%
      \pgfpathmoveto{\pgfpoint{-4bp}{\ht\bmb@box}}
      \pgfpathlineto{\pgfpoint{-4bp}{-3.2bp}}
      % \pgfpathqcurveto{-4bp}{-1.2bp}{-2.2bp}{-3bp}{0bp}{-3bp}
      \pgfpathlineto{\pgfpoint{\the\bmb@temp}{-3bp}}
      \pgfpathcurveto%
      {\pgfpoint{\the\bmb@dima}{-3bp}}%
      {\pgfpoint{\the\bmb@dimb}{-1.2bp}}%
      {\pgfpoint{\the\bmb@dimb}{1bp}}%
      {
      \bmb@dima=\ht\bmb@box%
      \pgfpathlineto{\pgfpoint{\bmb@dimb}{\bmb@dima}}
      \pgfsetstrokecolor{black}\pgfusepath{stroke, fill}
      }
    \end{pgfpicture}%
    \box\bmb@box%
  }%
  \vskip2bp%
  \egroup% of \vbox\bgroup
}
\makeatother

\defbeamertemplateparent{blocks}[framed]{block begin,block end,%
  block alerted begin,block alerted end,%
  block example begin,block example end}[1][]
{[#1]}

\defbeamertemplate{block begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title,lower=block body,#1]%
    {\raggedright\usebeamerfont*{block title}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body}%
}
\defbeamertemplate{block end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\defbeamertemplate{block alerted begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title alerted,lower=block body alerted,#1]%
    {\raggedright\usebeamerfont*{block title alerted}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body alerted}%
}%
\defbeamertemplate{block alerted end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\defbeamertemplate{block example begin}{framed}[1][]
{
  \par\vskip\medskipamount%
  \begin{beamerboxesframed}[upper=block title example,lower=block body example,#1]
    {\raggedright\usebeamerfont*{block title example}\insertblocktitle}%
    \raggedright%
    \usebeamerfont{block body alerted}%
}%
\defbeamertemplate{block example end}{framed}[1][]
{\end{beamerboxesframed}\vskip\smallskipamount}

\setbeamertemplate{blocks}[framed]

\setbeamertemplate{sidebar right}{}

